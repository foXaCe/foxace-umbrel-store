version: "3.7"
services:
  app_proxy:
    environment:
      APP_HOST: foxace-ygege_server_1
      APP_PORT: 8715
  server:
    image: uwucode/ygege:latest
    environment:
      - TZ=Europe/Paris
    volumes:
      - ${APP_DATA_DIR}/data/sessions:/app/sessions
      - ${APP_DATA_DIR}/data/config:/app/config
    entrypoint:
      - /bin/sh
      - -c
      - |
        # Create config directory
        mkdir -p /app/config

        # Create default config.json if it doesn't exist
        if [ ! -f /app/config/config.json ]; then
          cat > /app/config/config.json << 'EOF'
        {
          "username": "YOUR_YGG_USERNAME",
          "password": "YOUR_YGG_PASSWORD",
          "bind_ip": "0.0.0.0",
          "bind_port": 8715,
          "log_level": "info",
          "tmdb_token": null,
          "ygg_domain": null
        }
        EOF
          echo "Config created at /app/config/config.json - edit it with your YGG credentials!"
          echo "On Umbrel: ~/umbrel/app-data/foxace-ygege/data/config/config.json"
        fi

        # Start the application
        exec /app/ygege
    restart: on-failure
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8715/health"]
      interval: 90s
      timeout: 20s
      retries: 3
