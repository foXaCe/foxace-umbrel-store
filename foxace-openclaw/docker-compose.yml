version: "3.7"
services:
  app_proxy:
    environment:
      APP_HOST: foxace-openclaw_gateway_1
      APP_PORT: 18789
  gateway:
    image: ghcr.io/openclaw/openclaw:latest
    user: "1000:1000"
    environment:
      OPENCLAW_GATEWAY_TOKEN: "${APP_PASSWORD}"
      OPENCLAW_STATE_DIR: /data/.openclaw
      OPENCLAW_WORKSPACE_DIR: /data/workspace
      OPENCLAW_LOG_DIR: /data/logs
      NODE_ENV: production
      HOME: /home/node
    volumes:
      - "${APP_DATA_DIR}/data:/data"
    restart: on-failure
    init: true
    stop_grace_period: 30s
    entrypoint: /bin/sh
    command:
      - -c
      - |
        mkdir -p /data/.openclaw &&
        if [ ! -f /data/.openclaw/openclaw.json ]; then
          echo '{"gateway":{"controlUi":{"allowInsecureAuth":true,"dangerouslyDisableDeviceAuth":true}}}' > /data/.openclaw/openclaw.json
        fi &&
        exec node dist/index.js gateway --bind lan --port 18789 --allow-unconfigured
